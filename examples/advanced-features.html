<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My OpenLayers - 高级功能示例</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .map-container {
            width: 100%;
            height: 600px;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: bold;
            font-size: 14px;
        }
        
        button {
            padding: 8px 16px;
            background-color: #409EFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #337ecc;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .log-container {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-error {
            color: #e74c3c;
        }
        
        .log-info {
            color: #3498db;
        }
        
        .log-success {
            color: #27ae60;
        }
        
        .status-bar {
            background-color: #2c3e50;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>My OpenLayers - 高级功能示例</h1>
        
        <div class="status-bar">
            <div class="status-item">
                <span>🗺️ 地图状态:</span>
                <span id="mapStatus">未初始化</span>
            </div>
            <div class="status-item">
                <span>📍 坐标:</span>
                <span id="coordinates">-</span>
            </div>
            <div class="status-item">
                <span>🔍 缩放:</span>
                <span id="zoomLevel">-</span>
            </div>
            <div class="status-item">
                <span>📡 事件监听器:</span>
                <span id="listenerCount">0</span>
            </div>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <label>基础操作</label>
                <button onclick="initMap()">初始化地图</button>
                <button onclick="addSampleData()">添加示例数据</button>
                <button onclick="clearMap()">清空地图</button>
            </div>
            
            <div class="control-group">
                <label>事件管理</label>
                <button onclick="addClickListener()">添加点击监听</button>
                <button onclick="addHoverListener()">添加悬停监听</button>
                <button onclick="addZoomListener()">添加缩放监听</button>
                <button onclick="removeAllListeners()">移除所有监听</button>
            </div>
            
            <div class="control-group">
                <label>错误测试</label>
                <button onclick="testValidation()">测试验证</button>
                <button onclick="testErrorHandling()">测试错误处理</button>
                <button onclick="triggerError()">触发错误</button>
            </div>
            
            <div class="control-group">
                <label>配置管理</label>
                <button onclick="testConfigManager()">测试配置管理</button>
                <button onclick="showDefaultConfigs()">显示默认配置</button>
            </div>
        </div>
        
        <div id="mapContainer" class="map-container"></div>
        
        <h3>日志输出</h3>
        <div id="logContainer" class="log-container"></div>
        
        <button onclick="clearLog()" style="margin-top: 10px;">清空日志</button>
    </div>

    <script type="module">
        // 这里应该导入实际的库
        // import { MyOl, EventManager, ErrorHandler, ConfigManager } from '../dist/index.js'
        
        // 模拟库的功能（实际使用时请导入真实的库）
        let myOl = null;
        let eventManager = null;
        let map = null;
        
        // 日志功能
        function log(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('logContainer').innerHTML = '';
        }
        
        function updateStatus() {
            document.getElementById('mapStatus').textContent = myOl ? '已初始化' : '未初始化';
            if (eventManager) {
                const listenerInfo = eventManager.getListenersInfo ? eventManager.getListenersInfo() : [];
                document.getElementById('listenerCount').textContent = listenerInfo.length;
            }
        }
        
        // 全局函数
        window.initMap = function() {
            try {
                log('正在初始化地图...', 'info');
                
                // 这里应该是实际的地图初始化代码
                // myOl = new MyOl('mapContainer', {
                //     center: [116.4074, 39.9042],
                //     zoom: 10
                // });
                
                // 模拟初始化
                myOl = {
                    map: { /* 模拟地图对象 */ },
                    point: { /* 模拟点位操作 */ },
                    line: { /* 模拟线操作 */ },
                    polygon: { /* 模拟面操作 */ }
                };
                
                // eventManager = new EventManager(myOl.map);
                
                log('地图初始化成功！', 'success');
                updateStatus();
                
            } catch (error) {
                log(`地图初始化失败: ${error.message}`, 'error');
            }
        };
        
        window.addSampleData = function() {
            if (!myOl) {
                log('请先初始化地图', 'error');
                return;
            }
            
            try {
                log('正在添加示例数据...', 'info');
                
                // 模拟添加数据
                log('添加了示例点位数据', 'success');
                log('添加了示例线数据', 'success');
                log('添加了示例面数据', 'success');
                
            } catch (error) {
                log(`添加数据失败: ${error.message}`, 'error');
            }
        };
        
        window.clearMap = function() {
            if (!myOl) {
                log('地图未初始化', 'error');
                return;
            }
            
            try {
                log('正在清空地图...', 'info');
                // 实际清空操作
                log('地图已清空', 'success');
            } catch (error) {
                log(`清空地图失败: ${error.message}`, 'error');
            }
        };
        
        window.addClickListener = function() {
            if (!eventManager) {
                log('事件管理器未初始化', 'error');
                return;
            }
            
            try {
                // const listenerId = eventManager.on('click', (eventData) => {
                //     log(`点击位置: ${eventData.coordinate}`, 'info');
                //     if (eventData.feature) {
                //         log(`点击要素: ${eventData.feature.get('name') || '未命名'}`, 'info');
                //     }
                // });
                
                log('已添加点击事件监听器', 'success');
                updateStatus();
            } catch (error) {
                log(`添加点击监听失败: ${error.message}`, 'error');
            }
        };
        
        window.addHoverListener = function() {
            if (!eventManager) {
                log('事件管理器未初始化', 'error');
                return;
            }
            
            try {
                log('已添加悬停事件监听器', 'success');
                updateStatus();
            } catch (error) {
                log(`添加悬停监听失败: ${error.message}`, 'error');
            }
        };
        
        window.addZoomListener = function() {
            if (!eventManager) {
                log('事件管理器未初始化', 'error');
                return;
            }
            
            try {
                log('已添加缩放事件监听器', 'success');
                updateStatus();
            } catch (error) {
                log(`添加缩放监听失败: ${error.message}`, 'error');
            }
        };
        
        window.removeAllListeners = function() {
            if (!eventManager) {
                log('事件管理器未初始化', 'error');
                return;
            }
            
            try {
                // eventManager.clear();
                log('已移除所有事件监听器', 'success');
                updateStatus();
            } catch (error) {
                log(`移除监听器失败: ${error.message}`, 'error');
            }
        };
        
        window.testValidation = function() {
            try {
                log('测试坐标验证...', 'info');
                
                // 模拟验证测试
                log('✓ 有效坐标 (116.4, 39.9) 验证通过', 'success');
                log('✗ 无效坐标 (200, 100) 验证失败', 'error');
                log('✓ 有效颜色 "#ff0000" 验证通过', 'success');
                log('✗ 无效颜色 "invalid" 验证失败', 'error');
                
            } catch (error) {
                log(`验证测试失败: ${error.message}`, 'error');
            }
        };
        
        window.testErrorHandling = function() {
            try {
                log('测试错误处理机制...', 'info');
                
                // 模拟错误处理测试
                log('✓ 错误回调机制正常', 'success');
                log('✓ 错误日志记录正常', 'success');
                log('✓ 错误类型分类正常', 'success');
                
            } catch (error) {
                log(`错误处理测试失败: ${error.message}`, 'error');
            }
        };
        
        window.triggerError = function() {
            try {
                log('故意触发一个错误...', 'info');
                throw new Error('这是一个测试错误');
            } catch (error) {
                log(`捕获到错误: ${error.message}`, 'error');
            }
        };
        
        window.testConfigManager = function() {
            try {
                log('测试配置管理器...', 'info');
                
                // 模拟配置管理测试
                log('✓ 默认配置加载成功', 'success');
                log('✓ 配置合并功能正常', 'success');
                log('✓ 配置验证功能正常', 'success');
                log('✓ ID生成功能正常', 'success');
                
            } catch (error) {
                log(`配置管理测试失败: ${error.message}`, 'error');
            }
        };
        
        window.showDefaultConfigs = function() {
            try {
                log('显示默认配置...', 'info');
                
                // 模拟显示默认配置
                log('点位默认配置: strokeColor: #409EFF, strokeWidth: 2', 'info');
                log('线默认配置: strokeColor: #409EFF, strokeWidth: 2', 'info');
                log('面默认配置: fillColor: rgba(255,255,255,0.3)', 'info');
                log('图片默认配置: opacity: 1, visible: true', 'info');
                
            } catch (error) {
                log(`显示配置失败: ${error.message}`, 'error');
            }
        };
        
        // 初始化状态
        updateStatus();
        log('页面加载完成，请点击"初始化地图"开始', 'info');
    </script>
</body>
</html>